# AGENTS（役割分担と運用原則）テンプレ

## 目的

このリポジトリにおける AI 活用を「速く・安全に・再現可能」にする。  
最重要は、実装速度ではなく「事故らない速度」。

## 原則（Principles）

- Spec（仕様）が真実（Single Source of Truth）
- 変更は小さく、検証は固定化する
- 危険領域（秘密情報・外部送信・破壊的操作）を機械的に避ける
- 迷ったら「差分を減らす」選択をする

## 役割分担（Roles）

### 人間（Owner）
- 目的の最終決定、優先順位、捨てる判断
- 仕様の承認、公開情報の範囲決定
- 最終マージ判断

### Codex（実装者）
- Spec に基づく実装・整形・リファクタ
- 小さな反復（差分を薄く、何度も通す）
- エラー解消のための局所修正

### Claude Code（監査/設計レビュー）
- Spec の不足・矛盾の指摘
- 危険な変更の検知（秘密情報・権限・破壊的手順）
- 実装が意図と一致しているかの確認（読み物としてのレビュー）

## 禁則（Non-negotiables）

- `.env*`、SSH鍵、トークン、Cookie、個人情報は貼らない
- 外部送信（curl での投稿・外部アップロード）は原則禁止
- グローバル設定（`git config --global` 等）変更は禁止
- 自動生成物（`dist/` 等）をコミットしない（例外はSpecで定める）

## 進め方（Workflow）

1. Issue を作る（なぜ・なにを・どこまで）
2. Spec を作る（真実・不変条件・受け入れ条件）
3. Codex が実装（Spec 以外を増やさない）
4. `verify` / `ci` を通す（失敗したら原因を記録）
5. エビデンスを残す（必要なときだけ）
6. マージ前に Claude Code でレビュー（危険点の洗い出し）

## 最小プロンプト例

### Codex に渡す
- 「この Spec の受け入れ条件を満たすように、変更ファイルを最小にして実装して」
- 「`./scripts/ci.sh` が通るまで修正して。ログの要点もまとめて」

### Claude Code に渡す
- 「この差分は Spec と矛盾しない？安全面で地雷ある？」
- 「将来壊れやすいポイントを3つ挙げて、保守しやすい代案も添えて」
